<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>ใบสั่งซื้อ โตโยต้า</ion-title>
    <ion-buttons slot="primary" *ngIf="id === undefined && mode !== 'view'">
      <ion-button (click)="refreshForm()">
        <ion-icon slot="icon-only" src="./assets/icons/refresh.svg"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-buttons slot="primary"  *ngIf="id !== undefined && mode !== 'view'">
      <ion-button (click)="cancelData()">
        <ion-icon slot="icon-only" name="trash"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-buttons slot="primary" *ngIf="mode !== 'view'">
      <ion-button (click)="submitForm()">
        <ion-icon slot="icon-only" src="./assets/icons/save.svg"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-buttons slot="primary" *ngIf="modepayment === 'ok'">
      <ion-button (click)="submitForm_Payment()">
        <ion-icon slot="icon-only" src="./assets/icons/save.svg"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
 <ion-content>
  <form [formGroup]="ionicForm" novalidate>
    <ion-grid>
      <div class="table1">
        <ion-row>
          <ion-col >
            <ion-item>
              <ion-label class="showlabel" position="floating">วันที่สั่งซื้อ</ion-label>
              <ion-input readonly [liIonic4Datepicker]="datePickerObj" type="text" formControlName="to_date"></ion-input>
              <span class="error" *ngIf="isSubmitted && errorControl.to_date.errors?.required">
                กรุณาระบุ วันที่สั่งซื้อ
              </span>
            </ion-item>
          </ion-col>
          <ion-col >
            <ion-item>
              <ion-label class="showlabel" position="floating">ผู้ขาย</ion-label>
              <ionic-selectable interface="floating" item-content formControlName="mtd_user_id" itemValueField="id"
                itemTextField="name" [items]="ports_sale" [canSearch]="true" closeButtonText="ยกเลิก">
              </ionic-selectable>
              <span class="error" *ngIf="isSubmitted && errorControl.mtd_user_id.errors?.required">
                กรุณาระบุ ผู้ขาย
              </span>
            </ion-item>
          </ion-col>
          <ion-col>
            <ion-item>
              <ion-label class="showlabel" position="floating">บริษัทที่สั่งซื้อ</ion-label>
              <ion-input formControlName="company_name" type="text"></ion-input>
              <span class="error" *ngIf="isSubmitted && errorControl.company_name.errors?.required">
                กรุณาระบุ บริษัทที่สั่งซื้อ
              </span> 
            </ion-item>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="4.3"> 
            <ion-item>
              <ion-label class="showlabel" position="floating">ที่อยู่ที่ให้ออกบิล (บ้านเลขที่ ซอย ถนน)</ion-label>
              <ion-input formControlName="company_address" type="text"></ion-input>
              <span class="error" *ngIf="isSubmitted && errorControl.company_address.errors?.required">
                กรุณาระบุ ที่อยู่ที่ให้ออกบิล (บ้านเลขที่ ซอย ถนน)
              </span> 
            </ion-item>
          </ion-col>
          <ion-col>
            <ion-label>
              <ion-auto-complete class="showlabel" [labelPosition]="'floating'" [label]="'ที่อยู่ที่ให้ออกบิล ( แขวง/ตำบล เขต/อำเภอ จังหวัด รหัสไปรษณีย์)'" formControlName="company_address_place"
              [dataProvider]="placeSv"></ion-auto-complete>
              <span class="error" *ngIf="isSubmitted && errorControl.company_address_place.errors?.required">
                กรุณาระบุ ที่อยู่ที่ให้ออกบิล ( แขวง/ตำบล เขต/อำเภอ จังหวัด รหัสไปรษณีย์)
              </span>
            </ion-label>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="4.3"> 
            <ion-item>
              <ion-label class="showlabel" position="floating">ที่อยู่ที่ในการจัดส่ง (บ้านเลขที่ ซอย ถนน)</ion-label>
              <ion-input formControlName="company_addresssend" type="text"></ion-input>
              <span class="error" *ngIf="isSubmitted && errorControl.company_addresssend.errors?.required">
                กรุณาระบุ ที่อยู่ที่ในการจัดส่ง (บ้านเลขที่ ซอย ถนน)
              </span> 
            </ion-item>
          </ion-col>
          <ion-col>
            <ion-label>
              <ion-auto-complete class="showlabel" [labelPosition]="'floating'" [label]="'ที่อยู่ที่ในการจัดส่ง ( แขวง/ตำบล เขต/อำเภอ จังหวัด รหัสไปรษณีย์)'" formControlName="company_addresssend_place"
              [dataProvider]="placeSv"></ion-auto-complete>
              <span class="error" *ngIf="isSubmitted && errorControl.company_addresssend_place.errors?.required">
                กรุณาระบุ ที่อยู่ที่ในการจัดส่ง ( แขวง/ตำบล เขต/อำเภอ จังหวัด รหัสไปรษณีย์)
              </span>
            </ion-label>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <ion-item>
              <ion-label class="showlabel" position="floating">ชื่อผู้มาติดต่อ</ion-label>
              <ion-input formControlName="contact_name" type="text"></ion-input>
              <span class="error" *ngIf="isSubmitted && errorControl.contact_name.errors?.required">
                กรุณาระบุ ชื่อผู้มาติดต่อ
              </span>
            </ion-item>
          </ion-col>
          <ion-col>
            <ion-item>
              <ion-label class="showlabel" position="floating">เบอร์โทร.</ion-label>
              <ion-input formControlName="contact_tel" type="text"></ion-input>
              <span class="error" *ngIf="isSubmitted && errorControl.contact_tel.errors?.required">
                กรุณาระบุ เบอร์โทร.
              </span>
            </ion-item>
          </ion-col>
          <ion-col>
            <ion-item>
              <ion-label class="showlabel" position="floating">เบอร์ fax.</ion-label>
              <ion-input formControlName="contact_fax" type="text"></ion-input>
              <span class="error" *ngIf="isSubmitted && errorControl.contact_fax.errors?.required">
                กรุณาระบุ fax.
              </span>
            </ion-item>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col >
            <ion-item>
              <ion-label class="showlabel" position="floating">การคำนวณภาษี</ion-label>
              <ionic-selectable interface="floating" item-content formControlName="vat_type" itemValueField="id"
                itemTextField="type" [items]="ports_vat" [canSearch]="true" closeButtonText="ยกเลิก" (onChange)="portChange_typevat($event)">
              </ionic-selectable>
              <span class="error" *ngIf="isSubmitted && errorControl.vat_type.errors?.required">
                กรุณาระบุ การคำนวณภาษี
              </span>
            </ion-item>
          </ion-col>
        </ion-row>
      </div>
      <p></p>
      <div class="table1">
        <ion-row>
          <ion-col>
            <ion-item>
              <ion-label class="showlabelmain" position="floating">เลือกสินค้า</ion-label> 
             <ionic-selectable item-content itemValueField="id" itemTextField="name" [isMultiple]="true" [canSearch]="true" [items]="ports_productmain" (onChange)="portChange_Product($event)">
              <ng-template ionicSelectableItemTemplate let-port="item" let-isPortSelected="isItemSelected">
                <div [ngClass]="{'qtychk': inqtyerror(port.qty,port.qty_remain)}" >{{port.name}} remain: {{port.qty_remain}} qty: {{port.qty}}</div>
              </ng-template>
            </ionic-selectable>
            <span class="error" *ngIf="isSubmitted && tmpproduct.length===0">
              กรุณาเลือก สินค้า
            </span>
            </ion-item>
          </ion-col>
        </ion-row>
        <div *ngIf="tmpproduct.length>0">
          <ion-row  class="table1_header">
            <ion-col size="0.5">#</ion-col>
            <ion-col size="4">สินค้า/ขนาด/ราคา</ion-col>
            <ion-col size="2">ราคา</ion-col>
            <ion-col size="2">จำนวน</ion-col>
            <ion-col size="2">ราคารวม</ion-col>
            <ion-col size="2"></ion-col>
          </ion-row>
          <ion-row  *ngFor="let c of tmpproduct;let i = index; " [ngClass]="(i % 2 == 0) ? 'table1_detail_odd' : 'table1_detail_even'">
            <ion-col  size="0.5">{{i+1}}</ion-col>
            <ion-col size="4">{{c.name}}</ion-col>
            <ion-col size="2">
              <ion-input  class="showborder" type="number"  [(ngModel)]="per_price[c.id]" [ngModelOptions]="{standalone: true}" (keyup)="Caltotal(c.id,per_price[c.id],'price')"></ion-input>
            </ion-col>
            <ion-col size="2">
              <ion-input  class="showborder" type="number"  [(ngModel)]="per_qty[c.id]" [ngModelOptions]="{standalone: true}" (keyup)="Caltotal(c.id,per_qty[c.id],'qty')"></ion-input>
            </ion-col>
            <ion-col size="2">
              {{c.total|number : '1.2-2'}}
            </ion-col>
            <ion-col>
              <ion-button *ngIf="mode !== 'view'" (click)="Deltmpproduct(c.id,c.id)">
                <ion-icon slot="icon-only" class="iconSize" name="trash"></ion-icon>
              </ion-button>
            </ion-col>
            <ion-col *ngIf="isSubmitted && c.total === 0">
              <span class="error" >
                สินค้าลำดับที่ {{i+1}} ไม่ได้ระบุจำนวน/ราคา
               </span>
            </ion-col>
          </ion-row>
          <div class="table1_footer">
            <ion-row >
              <ion-col size="8.5" style="text-align: right;">รวมเป็นเงิน</ion-col>
              <ion-col size="3.5" style="text-align: center;">{{alltotalproduct|number : '1.2-2'}}</ion-col>
            </ion-row>
            <ion-row >
              <ion-col size="8.5" style="text-align: right;">ภาษีมูลค่าเพิ่ม 7%
                
              </ion-col>
              <ion-col size="3.5" style="text-align: center;">{{vat7|number : '1.2-2'}}</ion-col>
            </ion-row>
            <ion-row >
              <ion-col size="8.5" style="text-align: right;">จำนวนเงินทั้งสิ้น</ion-col>
              <ion-col size="3.5" style="text-align: center;">{{sumtotal|number : '1.2-2'}}</ion-col>
            </ion-row>
          </div>
        </div>
        
      </div>
    </ion-grid>
  </form>
</ion-content>
