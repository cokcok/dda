<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>จัดการงานปัก/ป้ายเขียว/ประกอบ</ion-title>
  </ion-toolbar>
</ion-header>
<form [formGroup]="ionicForm" novalidate>
  <ion-grid fixed>
    <ion-row>
      <ion-col >
        <ion-item>
          <ion-label class="showlabelheader" position="floating" >ประเภทการค้นหา</ion-label>
          <ionic-selectable
            interface="floating"
            item-content
            formControlName="typeserch_id"
            itemValueField="id"
            itemTextField="typeserch"
            [items]="portssearch"
            [canSearch]="true" 
            closeButtonText="ยกเลิก"
            (onChange)="portChange($event)"
            >
          </ionic-selectable>
          <span class="error" *ngIf="isSubmitted && errorControl.mtd_size_id.errors?.required">
            กรุณาระบุ ประเภทการค้นหา
          </span>
        </ion-item>
      </ion-col>
      <ion-col>
        <ion-item>
          <ion-label class="showlabelheader" position="floating">คำค้นหา</ion-label>
          <ion-input *ngIf="myarraytxt.includes(typeserch)" formControlName="txtserach" type="text"></ion-input>
          <ion-input *ngIf="myarraytxtdate.includes(typeserch)" formControlName="txtserach" readonly [liIonic4Datepicker]="datePickerObj" type="text"></ion-input>
          <span class="error" *ngIf="isSubmitted && errorControl.txtserach.errors?.required">
            กรุณาระบุ คำค้นหา
          </span>
        </ion-item>
      </ion-col>
      <ion-col>
          <ion-button [disabled]="ionicForm.invalid" (click)="SearchData(0,true)" expand="block"
          shape="round">
          ค้นหาข้อมูล
        </ion-button>
      </ion-col>
    </ion-row>
    <ion-row class="content_alert"*ngIf="search === true">
      <ion-col>
        พบข้อมูลที่ค้นหา จำนวน  {{maxdatalimit}} ข้อมูล
      </ion-col>
    </ion-row>
  </ion-grid>
</form>
<ion-content>
  <div>
    <ion-searchbar placeholder="ค้นหา..." [(ngModel)]="filterTerm" animated="true"></ion-searchbar>
    <ion-card *ngFor="let c of data  | filter:filterTerm;index as i">
      <ion-grid fixed>
        <ion-row>
          <ion-col>
            <ion-label class="showlabelheader">ใบสั่งซื้อ: {{ c.po_running }}</ion-label>
          </ion-col>
        </ion-row> 
        <ion-row>
          <ion-col>
            <ion-label> <u class="showlabelheader">ผู้ขาย:</u> {{ c.name }}</ion-label>
          </ion-col>
          <ion-col>
            <ion-label> <u class="showlabelheader">Tel:</u> {{ c.po_customer_tel }}</ion-label>
          </ion-col>
          <ion-col>
            <ion-label> <u class="showlabelheader">วันที่สั่งซื้อ:</u> {{ c.po_date }}</ion-label>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <ion-label> <u class="showlabelheader">ชื่อวิน:</u> {{ c.po_namewin }}</ion-label>
          </ion-col>
          <ion-col>
            <ion-label> <u class="showlabelheader">เขต:</u> {{ c.area_name }}</ion-label>
          </ion-col>
          <ion-col>
            <ion-label> <u class="showlabelheader">เบอร์/สี:</u> {{ c.podetail_number }}/{{ c.colorfront }}-{{ c.colorback }}</ion-label>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <ion-label> <u class="showlabelheader">สินค้า:</u> {{ c.product_name }}</ion-label>
          </ion-col>
          <ion-col >
            <ion-label> <u class="showlabelheader">ขนาด:</u> {{ c.size }}</ion-label>
          </ion-col>
          <ion-col [style.background-color]="getColor(c.po_recivedate)">
            <ion-label> <span style="color: black;"><u>วันนัดรับ:</u> {{ c.po_recivedate }}</span></ion-label>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <ion-label> <u class="showlabelheader">สินค้าอื่นๆ:</u> {{ c.etc }}</ion-label>
          </ion-col>
          <ion-col>
            <ion-label> <u class="showlabelheader">หมายเหตุ:</u> {{ c.podetail_comment }}</ion-label>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <ion-label> <u class="showlabelheader">สถานะปักเลข :</u><span  [ngClass]="(c.assign_status== 0)?'postatus_alert':'postatus_ok'" > {{ c.assign_statustext }}</span></ion-label> 
          </ion-col>
          <ion-col>
            <ion-label> <u class="showlabelheader">สถานะป้ายเขียว :</u><span  [ngClass]="(c.assign_status1== 0)?'postatus_alert':'postatus_ok'" > {{ c.assign_status1text }}</span></ion-label> 
          </ion-col>
          <ion-col>
            <ion-label> <u class="showlabelheader">สถานะประกอบ :</u><span  [ngClass]="(c.assign_status2== 0)?'postatus_alert':'postatus_ok'" > {{ c.assign_status2text }}</span></ion-label> 
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col >
            <ion-button  disabled={{c.assignstatus_edit}} (click)="RestoreData(c.assign_id,'number')">คืนสถานะปักเลข</ion-button>
          </ion-col>
          <ion-col >
            <ion-button  disabled={{c.assignstatus1_edit}} (click)="RestoreData(c.assign_id,'green')">คืนสถานะป้ายเขียว</ion-button>
          </ion-col>
          <ion-col>
            <ion-button disabled={{c.assignstatus2_edit}} (click)="RestoreData(c.assign_id,'install')">คืนสถานะประกอบ</ion-button>
          </ion-col>
         
        </ion-row>
        <ion-row *ngIf="c.problem_cause != ''">
          <ion-col>
            <ion-label> <u class="showlabelheader">งานส่งมีปัญหา:</u> {{ c.problem_cause }}</ion-label>
          </ion-col>
        </ion-row>
        <ion-row  *ngIf="c.picresizbase64List.length > 0">
          <ion-col size="12">
            <div>
              <ion-row>
                <ion-text color="primary">
                ภาพประกอบ
                </ion-text>
              </ion-row>
              <div >
                <div  style="display: inline-block;" *ngFor="let img of c.picresizbase64List" >
                 <ion-img style="width: 100px; height: 100px;"  [src]="img.urlresize"></ion-img>
                 <ion-button *ngIf="img.detail_id !== undefined" (click)="showImg(img.detail_id,img.name)">
                  <ion-icon slot="icon-only" size="small" name="search"></ion-icon>
                </ion-button>
                </div>
               </div>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card>
    <ion-infinite-scroll (ionInfinite)="doInfinite($event)">
      <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="Loading more data...">
      </ion-infinite-scroll-content>
    </ion-infinite-scroll>
  </div>
</ion-content>
